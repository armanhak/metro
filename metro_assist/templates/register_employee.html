{% extends "base.html" %}

{% block content %}
<h1>Регистрация сотрудника</h1>
<form method="post">
    {% csrf_token %}
    <div class="form-group">
        <label for="full_name">Фамилия</label>
        <input type="text" class="form-control" id="last_name" name="last_name" required>
    </div>
    <div class="form-group">
        <label for="full_name">Имя</label>
        <input type="text" class="form-control" id="first_name" name="first_name" required>
    </div>
    <div class="form-group">
        <label for="initials">Отчество</label>
        <input type="text" class="form-control" id="patronymic" name="patronymic" required>
    </div>
    <div class="form-group">
        <label for="gender">Пол</label>
        <select class="form-control" id="gender" name="gender">
            {% for gender in genders %}
            <option value="{{ gender.id }}">{{ gender.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="smena">Смена сотрудника</label>
        <select class="form-control" id="smena" name="smena">
            {% for smena in smenas %}
            <option value="{{ smena.id }}">{{ smena.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="rank">Должность сотрудника</label>
        <select class="form-control" id="rank" name="rank">
            {% for rank in ranks %}
                <option value="{{ rank.id }}">{{ rank.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label for="uchastok">Участок</label>
        <select class="form-control" id="uchastok" name="uchastok">
            <option value="" selected disabled>Выберите участок</option>
            {% for uchastok in uchastoks %}
                <option value="{{ uchastok.id }}">{{ uchastok.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="distribution_date">Дата выхода на работу</label>
        <input type="date" class="form-control" id="start_work_date" name="start_work_date" required>
    </div>
    <div class="form-group">
        <label for="work_time">Время работы</label>
        <select class="form-control" id="work_time" name="work_time">
            <!-- Варианты будут динамически добавлены с помощью JavaScript -->
        </select>
    </div>
    <div class="form-group">
        <label for="work_phone">Рабочий телефон</label>
        <input type="text" class="form-control" id="work_phone" name="work_phone" required>
    </div>
    <div class="form-group">
        <label for="personal_phone">Личный телефон</label>
        <input type="text" class="form-control" id="personal_phone" name="personal_phone" required>
    </div>
    <div class="form-group">
        <label for="tab_number">Табельный номер</label>
        <input type="text" class="form-control" id="tab_number" name="tab_number" required>
    </div>
    <div class="form-group">
        <label for="light_duty">Легкий труд</label>
        <select class="form-control" id="light_duty" name="light_duty">
            <option value="False">Нет</option>
            <option value="True">Да</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Сохранить</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var uchastokSelect = document.getElementById('uchastok');
    var workTimeSelect = document.getElementById('work_time');

    uchastokSelect.addEventListener('change', function() {
        var uchastokId = uchastokSelect.value;

        fetch(`/get_work_times/?uchastok_id=${uchastokId}`)
            .then(response => response.json())
            .then(data => {
                workTimeSelect.innerHTML = '';
                data.forEach(function(time) {
                    var option = document.createElement('option');
                    option.value = time.id;
                    option.textContent = `${time.start_time} - ${time.end_time}`;
                    workTimeSelect.appendChild(option);
                });
            });
    });
});
</script>
{% endblock %}
